/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a,b){if(typeof define=="function"&&define.amd)define(["backbone","underscore","socket.io","jquery"],b);else if(typeof exports=="object"){var c=require("underscore"),d=require("backbone"),e=require("socket.io-client"),f=require("jquery");module.exports=b(d,c,e,f)}else b(a.Backbone,a._,a.io,a.jQuery||a.Zepto||a.ender||a.$)})(this,function(a,b,c,d){a.sync=function(c,f,g){var h=b.extend({},g);h.url?h.url=b.result(h,"url"):h.url=b.result(f,"url")||e();var i=h.url.split("/");!h.data&&f&&(h.data=h.attrs||f.toJSON(g)||{}),h.patch===!0&&h.data.id==null&&f&&(h.data.id=f.id);var j=f.socket||a.socket||window.socket,k=d.Deferred();j.emit(h.url+":"+c,h.data,function(a,b){a?(g.error&&g.error(a),k.reject()):(g.success&&g.success(b),k.resolve())});var l=k.promise();return f.trigger("request",f,l,g),l};var e=function(){throw new Error('A "url" property or function must be specified')};return a})