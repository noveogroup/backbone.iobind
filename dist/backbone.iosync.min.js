/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a){var b,c,d,e;typeof window=="undefined"||typeof require=="function"?(c=require("jquery"),b=require("underscore"),d=require("backbone"),e=d,module&&(module.exports=e)):(c=this.$,b=this._,d=this.Backbone,e=this),d.sync=function(a,e,f){var g=function(a){if(f&&f.url)return b.result(f,"url")||urlError();if(a&&a.url)return b.result(a,"url")||urlError();urlError()},h=g(e).split("/"),i=h[0]!==""?h[0]:h[1],j=b.extend({req:i+":"+a},f);!j.data&&e&&(j.data=e.toJSON(f)||{});var k=e.socket||window.socket||d.socket,l=f.success;f.success=function(a){l&&l(e,a,f),e.trigger("sync",e,a,f)};var m=f.error;f.error=function(a){m&&m(e,a,f),e.trigger("error",e,a,f)};var n=c.Deferred();return k.emit(i+":"+a,j.data,function(a,b){a?(f.error(a),n.reject()):(f.success(b),n.resolve())}),promise=n.promise(),e.trigger("request",e,promise,f),promise}})()