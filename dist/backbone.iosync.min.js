/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a,b){if(typeof define=="function"&&define.amd)define(["backbone","underscore","socket.io","jquery"],b);else if(typeof exports=="object"){var c=require("underscore"),d=require("backbone"),e=require("socket.io-client"),f=require("jquery");module.exports=b(d,c,e,f)}else b(a.Backbone,a._,a.io,a.jQuery||a.Zepto||a.ender||a.$)})(this,function(a,b,c,d){var e=a.sync,f=function(c,e,f){var g=b.extend({},f);g.url?g.url=b.result(g,"url"):g.url=b.result(e,"url")||h();var i=g.url.split("/"),j=i[0]!==""?i[0]:i[1];!g.data&&e&&(g.data=g.attrs||e.toJSON(f)||{}),g.patch===!0&&g.data.id==null&&e&&(g.data.id=e.id);var k=e.socket||a.socket||window.socket,l=d.Deferred();k.emit(j+":"+c,g.data,function(a,b){a?(f.error&&f.error(a),l.reject()):(f.success&&f.success(b),l.resolve())});var m=b.extend(l.promise(),{abort:function(){e.trigger("abort",e,m,f)}});return e.trigger("request",e,m,f),m},g=function(a){return b.result(a.ajaxSync)?e:f};a.sync=function(a,b,c){return g(b).apply(this,[a,b,c])};var h=function(){throw new Error('A "url" property or function must be specified')};return a})