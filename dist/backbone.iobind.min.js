/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a){var b,c,d,e;typeof window!="undefined"&&window.window===window||typeof require!="function"?(c=this.$,b=this._,d=this.Backbone,e=this):(c=require("jquery"),b=require("underscore"),d=require("backbone"),e=d,typeof module!="undefined"&&(module.exports=e)),d.Model.prototype.ioBindVersion="0.4.7",d.Model.prototype.ioBind=function(a,c,e,f){var g=this._ioEvents||(this._ioEvents={}),h=b.result(this,"url")+":"+a,i=this;"function"==typeof c&&(f=e,e=c,c=this.socket||window.socket||d.socket);var j={name:a,global:h,cbLocal:e,cbGlobal:function(){var b=[a];b.push.apply(b,arguments),i.trigger.apply(i,b)}};return this.bind(j.name,j.cbLocal,f||i),c.on(j.global,j.cbGlobal),g[j.name]?g[j.name].push(j):g[j.name]=[j],this},d.Model.prototype.ioUnbind=function(a,c,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url()+":"+a;"function"==typeof c&&(e=c,c=this.socket||window.socket||d.socket);var h=f[a];if(!b.isEmpty(h)){if(e&&"function"==typeof e){for(var i=0,j=h.length;i<j;i++)e==h[i].cbLocal&&(this.unbind(h[i].name,h[i].cbLocal),c.removeListener(h[i].global,h[i].cbGlobal),h[i]=!1);h=b.compact(h)}else this.unbind(a),c.removeAllListeners(g),delete c.$events[g];h.length===0&&delete f[a]}return this},d.Model.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=this.socket||window.socket||d.socket);for(var c in b)this.ioUnbind(c,a);return this},d.Collection.prototype.ioBindVersion="0.4.7",d.Collection.prototype.ioBind=function(a,c,e,f){var g=this._ioEvents||(this._ioEvents={}),h=b.result(this,"url")+":"+a,i=this;"function"==typeof c&&(f=e,e=c,c=this.socket||window.socket||d.socket);var j={name:a,global:h,cbLocal:e,cbGlobal:function(){var b=[a];b.push.apply(b,arguments),i.trigger.apply(i,b)}};return this.bind(j.name,j.cbLocal,f),c.on(j.global,j.cbGlobal),g[j.name]?g[j.name].push(j):g[j.name]=[j],this},d.Collection.prototype.ioUnbind=function(a,c,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url+":"+a;"function"==typeof c&&(e=c,c=this.socket||window.socket||d.socket);var h=f[a];if(!b.isEmpty(h)){if(e&&"function"==typeof e){for(var i=0,j=h.length;i<j;i++)e==h[i].cbLocal&&(this.unbind(h[i].name,h[i].cbLocal),c.removeListener(h[i].global,h[i].cbGlobal),h[i]=!1);h=b.compact(h)}else this.unbind(a),c.removeAllListeners(g),delete c.$events[g];h.length===0&&delete f[a]}return this},d.Collection.prototype.ioUnbindAll=function(a){var b=this._ioEvents||(this._ioEvents={});a||(a=this.socket||window.socket||d.socket);for(var c in b)this.ioUnbind(c,a);return this}})()