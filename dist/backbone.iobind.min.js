/*!
 * backbone.iobind
 * Copyright(c) 2011 Jake Luer <jake@alogicalparadox.com>
 * MIT Licensed
 * https://github.com/logicalparadox/backbone.iobind
 */

(function(a,b){if(typeof define=="function"&&define.amd)define(["backbone","underscore","socket.io","jquery"],b);else if(typeof exports=="object"){var c=require("underscore"),d=require("backbone"),e=require("socket.io-client"),f=require("jquery");module.exports=b(d,c,e,f)}else b(a.Backbone,a._,a.io,a.jQuery||a.Zepto||a.ender||a.$)})(this,function(a,b,c,d){return a.Model.prototype.ioBindVersion="0.4.10",a.Model.prototype.ioBind=function(c,d,e,f){var g=this._ioEvents||(this._ioEvents={}),h=b.result(this,"url")+":"+c,i=this;"function"==typeof d&&(f=e,e=d,d=this.socket||window.socket||a.socket);var j={name:c,global:h,cbLocal:e,cbGlobal:function(){var a=[c];a.push.apply(a,arguments),i.trigger.apply(i,a)}};return this.bind(j.name,j.cbLocal,f||i),d.on(j.global,j.cbGlobal),g[j.name]?g[j.name].push(j):g[j.name]=[j],this},a.Model.prototype.ioUnbind=function(c,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url()+":"+c;"function"==typeof d&&(e=d,d=this.socket||window.socket||a.socket);var h=f[c];if(!b.isEmpty(h)){if(e&&"function"==typeof e){for(var i=0,j=h.length;i<j;i++)e==h[i].cbLocal&&(this.unbind(h[i].name,h[i].cbLocal),d.removeListener(h[i].global,h[i].cbGlobal),h[i]=!1);h=b.compact(h)}else this.unbind(c),d.removeAllListeners(g),d.$events&&delete d.$events[g];h.length===0&&delete f[c]}return this},a.Model.prototype.ioUnbindAll=function(b){var c=this._ioEvents||(this._ioEvents={});b||(b=this.socket||window.socket||a.socket);for(var d in c)this.ioUnbind(d,b);return this},a.Collection.prototype.ioBindVersion="0.4.10",a.Collection.prototype.ioBind=function(c,d,e,f){var g=this._ioEvents||(this._ioEvents={}),h=b.result(this,"url")+":"+c,i=this;"function"==typeof d&&(f=e,e=d,d=this.socket||window.socket||a.socket);var j={name:c,global:h,cbLocal:e,cbGlobal:function(){var a=[c];a.push.apply(a,arguments),i.trigger.apply(i,a)}};return this.bind(j.name,j.cbLocal,f),d.on(j.global,j.cbGlobal),g[j.name]?g[j.name].push(j):g[j.name]=[j],this},a.Collection.prototype.ioUnbind=function(c,d,e){var f=this._ioEvents||(this._ioEvents={}),g=this.url+":"+c;"function"==typeof d&&(e=d,d=this.socket||window.socket||a.socket);var h=f[c];if(!b.isEmpty(h)){if(e&&"function"==typeof e){for(var i=0,j=h.length;i<j;i++)e==h[i].cbLocal&&(this.unbind(h[i].name,h[i].cbLocal),d.removeListener(h[i].global,h[i].cbGlobal),h[i]=!1);h=b.compact(h)}else this.unbind(c),d.removeAllListeners(g),d.$events&&delete d.$events[g];h.length===0&&delete f[c]}return this},a.Collection.prototype.ioUnbindAll=function(b){var c=this._ioEvents||(this._ioEvents={});b||(b=this.socket||window.socket||a.socket);for(var d in c)this.ioUnbind(d,b);return this},a})